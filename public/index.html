<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Gossip's Cafe</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link href="css/index.css?3" rel="stylesheet">
        <link rel="shortcut icon" type="image/png" href="images/favicon.png">
        <!-- twitter -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Gossip's Cafe">
        <meta name="twitter:description" content="open daily 8am to 7pm">
        <meta name="twitter:image" content="http://gossips.cafe/images/social.jpg"/>
    </head>
        
    <body>
        <main>
            <header>
                <h1 id="title">Gossip's Caf√© ‚òïÔ∏è</h1>
        
                <p id="date"><i>...</i></p>
    
                <div class="clear"></div>
            </header>
    
            <!-- <p>Today the brew is <i id="brew">üêÅ</i></p> -->
    
            <p>The cafe is open daily from 8am to 7pm. Posts expire 8 hours after their creation. There is no archive üçÉ</p>

            <br />

            <p><a href="/kitchen" class="button">+</a></p>

            <h2>caf√© tunes</h2>
    
            <section id="office-tunes">
            </section>

            <h2>coffee break</h2>
    
            <section id="coffee-break">
            </section>

            <!-- <h2>news from the mouse pad</h2>
    
            <section id="mouse-pad">
            </section> -->

            <br />

            <p><a href="/clock" class="button">clock in</a></p>

            <h2>what are we doing today?</h2>
    
            <section id="people">
            </section>
        </main>

        <div id="closed">
            <div id="closed-text">
                <p>‚ú®</p>
                <p>sorry, the cafe is closed. please come back at 8 am.</p>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function(){
                // get links
                fetch('/links')
                .then(response => response.json())
                .then(data => {
                    var officeTunes = document.querySelector('#office-tunes');
                    var coffeeBreak = document.querySelector('#coffee-break');
                    var mousePad = document.querySelector('#mouse-pad');

                    // function isOdd(num) { return num % 2;}

                    latestPostDate = data[0].creationDate;
                    var readableDate = new Date(latestPostDate);
                    var day = readableDate.getDate();
                    // var brew = (isOdd(day) ? 'light' : 'dark');
                    var readableDateAMPM = readableDate.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })

                    // console.log(readableDate);

                    document.querySelector('#date').innerHTML = 'Last updated: ' + readableDateAMPM;
                    // document.querySelector('#brew').innerHTML = brew;

                    data.map((item) => {
                        var p = document.createElement("p");
                        p.innerHTML = `<a href="${item.link}">${item.title}</a>`;

                        if(item.type == 'office_tunes')
                            officeTunes.appendChild(p);
                        else if(item.type == 'coffee_break')
                            coffeeBreak.appendChild(p);
                        else if(item.type == 'mouse_pad') {
                            mousePad.appendChild(p);
                        }
                    });
                })
                .catch(error => console.error(error))

                // cafe hours
                var hour = new Date().getHours();
                console.log(hour);
                if(hour > 18 || hour < 8) {
                    console.log('cafe closed');
                } else {
                    console.log('cafe open');
                    var el = document.querySelector("#closed");
                    el.classList.add("open");
                }

                // get statuses
                fetch('/statuses')
                .then(response => response.json())
                .then(data => {
                    var peopleEl = document.querySelector('#people');

                    data.map((item) => {
                        var p = document.createElement("p");
                        var readableDate = new Date(item.creationDate);
                        var readableDateAMPM = readableDate.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })
                        p.innerHTML = `[${readableDateAMPM}] ~${item.name} ‚Äì ${item.status}`;

                        peopleEl.appendChild(p);
                    });
                })
                .catch(error => console.error(error))

            });
        </script>

    </body>
</html>