<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Gossip's Cafe</title>
        <meta name="description" content="Just one sip and you'll be hooked.">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link href="css/index.css?4" rel="stylesheet">
        <link rel="shortcut icon" type="image/png" href="images/favicon.png">
        <!-- twitter -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Gossip's Cafe">
        <meta name="twitter:description" content="open daily 8am to 7pm">
        <meta name="twitter:image" content="http://gossips.cafe/images/social.jpg"/>
    </head>
        
    <body>
        <main>
            <header>
                <h1 id="title">☕️ Gossip's Café</h1>
        
                <p id="time"><i>...</i></p>
    
                <div class="clear"></div>
            </header>
    
            <p>the cafe is open daily from 8am to 7pm. please join us.
                
            <ul>
                <li>♻️ posts expire 8 hours after their creation.</li>
                <li>🍃 there is no archive.</li>
            </ul>

            <br />

            <p><a href="/kitchen" class="button emoji">+</a></p>

            <h2>♩ tunes</h2>
    
            <section id="office-tunes">
            </section>

            <h2>🧹coffee break</h2>
    
            <section id="coffee-break">
            </section>

            <br />

            <p><a href="/clock" class="button emoji">clock in</a>

            <p></p>

            <h2>🐜 what are we doing today?</h2>
    
            <section id="people">
            </section>

            <p id="timestamp">...</p>
        </main>

        <div id="closed">
            <div id="closed-text">
                <p>✨</p>
                <p>sorry, the cafe is closed. we are open daily 8am to 7pm. please come back.</p><br /><br />

                <!-- <form method="POST" action="/post-note">
                    <label>leave a note</label><br />
                    <em>the staff will receive it in the morning</em><br /><br />
                    <select name="type" required>
                        <option value="" disabled="" selected="" hidden=""></option>
                        <option value="☕️">☕️</option>
                        <option value="❇️">❇️</option>
                        <option value="🥕">🥕</option>
                        <option value="🥭">🥭</option>
                    </select>
    
                    <input class="button" type="submit" value="post" />
                </form> -->
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function(){
                // get links
                fetch('/links')
                .then(response => response.json())
                .then(data => {
                    var officeTunes = document.querySelector('#office-tunes');
                    var coffeeBreak = document.querySelector('#coffee-break');
                    var mousePad = document.querySelector('#mouse-pad');

                    latestPostDate = data[0].creationDate;
                    var readableDate = new Date(latestPostDate);
                    var day = readableDate.getDate();
                    var readableDateAMPM = readableDate.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })

                    document.querySelector('#timestamp').innerHTML = 'Last updated: ' + readableDateAMPM;

                    data.map((item) => {
                        var p = document.createElement("p");
                        p.innerHTML = `<a href="${item.link}">${item.title}</a>`;

                        if(item.type == 'office_tunes')
                            officeTunes.appendChild(p);
                        else if(item.type == 'coffee_break')
                            coffeeBreak.appendChild(p);
                        else if(item.type == 'mouse_pad') {
                            mousePad.appendChild(p);
                        }
                    });
                })
                .catch(error => console.error(error))

                // Time
                var myVar = setInterval(myTimer, 1000);

                function myTimer() {
                    var d = new Date();
                    var t = d.toLocaleTimeString().toLowerCase();
                    document.getElementById("time").innerHTML = t;
                }
                myTimer();

                // cafe hours
                var hour = new Date().getHours();
                console.log(hour);
                if(hour > 18 || hour < 8) {
                    console.log('cafe closed');
                    console.log('cafe here');
                } else {
                    console.log('cafe open');
                    var el = document.querySelector("#closed");
                    el.classList.add("open");
                }

                // var el = document.querySelector("#closed");
                // el.classList.add("open");

                // get statuses
                fetch('/statuses')
                .then(response => response.json())
                .then(data => {
                    var peopleEl = document.querySelector('#people');

                    data.map((item) => {
                        var p = document.createElement("p");
                        var readableDate = new Date(item.creationDate);
                        var readableDateAMPM = readableDate.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true })
                        p.innerHTML = `[${readableDateAMPM}] ~${item.name} – ${item.status}`;

                        peopleEl.appendChild(p);
                    });
                })
                .catch(error => console.error(error))

            });
        </script>

    </body>
</html>
